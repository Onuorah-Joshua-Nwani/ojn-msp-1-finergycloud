[phases.install]
cmds = [
  "rm -rf node_modules package-lock.json",
  "npm cache clean --force",
  "npm install --legacy-peer-deps"
]

[phases.build]
cmds = [
  "npm run build",
  "npx esbuild server/minimal.ts --platform=node --packages=external --bundle --format=esm --outfile=dist/minimal.js"
]

[start]
cmd = "node dist/minimal.js"

[variables]
NODE_ENV = "production"
